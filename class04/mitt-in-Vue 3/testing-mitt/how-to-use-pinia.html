<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How to Use Pinia in This Vue 3 Application</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            border-bottom: 2px solid #4caf50;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            margin-top: 30px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        h3 {
            color: #555;
            margin-top: 20px;
        }
        code {
            background-color: #f1f1f1;
            padding: 2px 4px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }
        pre {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            border-left: 4px solid #4caf50;
        }
        pre code {
            background-color: transparent;
            padding: 0;
        }
        ul, ol {
            padding-left: 20px;
        }
        li {
            margin-bottom: 8px;
        }
        a {
            color: #4caf50;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        .toc {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 6px;
            margin-bottom: 30px;
        }
        .toc ul {
            list-style-type: none;
            padding-left: 0;
        }
        .toc li {
            margin-bottom: 10px;
        }
        .toc a {
            color: #2c3e50;
            text-decoration: none;
        }
        .toc a:hover {
            color: #4caf50;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f2f2f2;
        }
        .note {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 4px 4px 0;
        }
        .tip {
            background-color: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 4px 4px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>How to Use Pinia in This Vue 3 Application</h1>

        <p>This document explains how Pinia state management is implemented in this Vue 3 e-commerce application. Pinia is the recommended state management library for Vue 3, offering a simpler and more intuitive API compared to Vuex.</p>

        <div class="toc">
            <h2>Table of Contents</h2>
            <ul>
                <li><a href="#installation">1. Installation</a></li>
                <li><a href="#plugin-setup">2. Plugin Setup</a></li>
                <li><a href="#store-creation">3. Store Creation</a></li>
                <li><a href="#store-structure">4. Store Structure</a></li>
                <li><a href="#persistence-configuration">5. Persistence Configuration</a></li>
                <li><a href="#using-stores-in-components">6. Using Stores in Components</a></li>
                <li><a href="#crud-operations">7. CRUD Operations</a></li>
                <li><a href="#best-practices">8. Best Practices</a></li>
            </ul>
        </div>

        <h2 id="installation">Installation</h2>
        <p>Pinia is already included in the project dependencies. To install it in a new project:</p>
        <pre><code>npm install pinia</code></pre>
        <p>For localStorage persistence, we also need the persisted state plugin:</p>
        <pre><code>npm install pinia-plugin-persistedstate</code></pre>

        <h2 id="plugin-setup">Plugin Setup</h2>
        <p>The Pinia plugin is configured in <code>src/main.js</code>:</p>
        <pre><code>import { createApp } from 'vue'
import { createPinia } from 'pinia'
import piniaPluginPersistedstate from 'pinia-plugin-persistedstate'

import App from './App.vue'
import router from './router'

const app = createApp(App)

// Create Pinia instance
const pinia = createPinia()
// Add persisted state plugin
pinia.use(piniaPluginPersistedstate)

app.use(pinia)
app.use(router)

app.mount('#app')</code></pre>

        <h2 id="store-creation">Store Creation</h2>
        <p>Stores are created using the <code>defineStore</code> function from Pinia. Our main store is located at <code>src/stores/product.js</code>:</p>
        <pre><code>import { ref, computed } from 'vue'
import { defineStore } from 'pinia'

export const useProductStore = defineStore('product', () => {
  // State
  const products = ref([])
  const cart = ref([])
  const orders = ref([])
  const loading = ref(false)
  const error = ref(null)
  const productsLoaded = ref(false)

  // Getters (computed properties)
  const cartItemCount = computed(() => {
    return cart.value.reduce((total, item) => total + item.quantity, 0)
  })

  const cartTotal = computed(() => {
    return cart.value.reduce((total, item) => total + (item.price * item.quantity), 0)
  })

  const allOrders = computed(() => {
    return orders.value
  })

  // Actions (methods)
  async function fetchProducts() { /* ... */ }
  function addToCart(product) { /* ... */ }
  function removeFromCart(productId) { /* ... */ }
  function updateQuantity(productId, quantity) { /* ... */ }
  function placeOrder(orderDetails) { /* ... */ }

  // Return all state, getters, and actions
  return { 
    products, 
    cart, 
    orders,
    loading, 
    error,
    productsLoaded,
    fetchProducts, 
    addToCart, 
    removeFromCart, 
    updateQuantity,
    cartItemCount,
    cartTotal,
    placeOrder,
    allOrders
  }
}, {
  // Persistence configuration
  persist: {
    key: 'product-store',
    storage: localStorage,
    paths: ['products', 'cart', 'orders', 'productsLoaded']
  }
})</code></pre>

        <h2 id="store-structure">Store Structure</h2>
        <p>Our Pinia store follows the Composition API syntax with three main parts:</p>

        <h3>1. State</h3>
        <p>Reactive data properties using Vue's <code>ref()</code>:</p>
        <ul>
            <li><code>products</code>: Array of product items</li>
            <li><code>cart</code>: Array of items in the shopping cart</li>
            <li><code>orders</code>: Array of completed orders</li>
            <li><code>loading</code>: Boolean indicating API loading state</li>
            <li><code>error</code>: String containing error messages</li>
            <li><code>productsLoaded</code>: Boolean tracking if products have been loaded from API</li>
        </ul>

        <h3>2. Getters</h3>
        <p>Computed properties using Vue's <code>computed()</code>:</p>
        <ul>
            <li><code>cartItemCount</code>: Total number of items in cart</li>
            <li><code>cartTotal</code>: Total price of items in cart</li>
            <li><code>allOrders</code>: Computed list of all orders</li>
        </ul>

        <h3>3. Actions</h3>
        <p>Methods that can modify state:</p>
        <ul>
            <li><code>fetchProducts()</code>: Load products from API (only once)</li>
            <li><code>addToCart()</code>: Add product to shopping cart</li>
            <li><code>removeFromCart()</code>: Remove product from cart</li>
            <li><code>updateQuantity()</code>: Update product quantity in cart</li>
            <li><code>placeOrder()</code>: Create new order from cart items</li>
        </ul>

        <h2 id="persistence-configuration">Persistence Configuration</h2>
        <p>The store uses <code>pinia-plugin-persistedstate</code> to automatically sync specified state properties with localStorage:</p>
        <pre><code>{
  persist: {
    key: 'product-store',           // localStorage key
    storage: localStorage,          // Storage mechanism
    paths: ['products', 'cart', 'orders', 'productsLoaded'] // Properties to persist
  }
}</code></pre>
        <p>This ensures that:</p>
        <ul>
            <li>Products loaded from API are saved locally</li>
            <li>Cart items persist between page reloads</li>
            <li>Order history is maintained</li>
            <li>The <code>productsLoaded</code> flag prevents repeated API calls</li>
        </ul>

        <h2 id="using-stores-in-components">Using Stores in Components</h2>
        <p>To use the store in any Vue component:</p>

        <h3>1. Import the store</h3>
        <pre><code>import { useProductStore } from '@/stores/product'</code></pre>

        <h3>2. Initialize the store</h3>
        <pre><code>const productStore = useProductStore()</code></pre>

        <h3>3. Access state, getters, and actions</h3>
        <pre><code>&lt;template&gt;
  &lt;div&gt;
    &lt;!-- Access state --&gt;
    &lt;p&gt;Loading: {{ productStore.loading }}&lt;/p&gt;
    
    &lt;!-- Access getters --&gt;
    &lt;p&gt;Cart items: {{ productStore.cartItemCount }}&lt;/p&gt;
    
    &lt;!-- Call actions --&gt;
    &lt;button @click="productStore.addToCart(product)"&gt;
      Add to Cart
    &lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { useProductStore } from '@/stores/product'

const productStore = useProductStore()
&lt;/script&gt;</code></pre>

        <h2 id="crud-operations">CRUD Operations</h2>

        <h3>Create (Add Product)</h3>
        <pre><code>function addProduct(product) {
  const newProduct = {
    id: products.value.length > 0 ? Math.max(...products.value.map(p => p.id)) + 1 : 1,
    ...product
  }
  products.value.push(newProduct)
  return newProduct
}</code></pre>

        <h3>Read (Fetch Products)</h3>
        <pre><code>async function fetchProducts() {
  // Only fetch once
  if (productsLoaded.value) return
  
  loading.value = true
  error.value = null
  try {
    const response = await fetch('https://dummyjson.com/products')
    const data = await response.json()
    products.value = data.products
    productsLoaded.value = true
  } catch (err) {
    error.value = err.message
  } finally {
    loading.value = false
  }
}</code></pre>

        <h3>Update (Modify Product)</h3>
        <pre><code>function updateProduct(updatedProduct) {
  const index = products.value.findIndex(p => p.id === updatedProduct.id)
  if (index !== -1) {
    products.value[index] = updatedProduct
  }
}</code></pre>

        <h3>Delete (Remove Product)</h3>
        <pre><code>function deleteProduct(productId) {
  products.value = products.value.filter(p => p.id !== productId)
  // Also remove from cart if present
  cart.value = cart.value.filter(item => item.id !== productId)
}</code></pre>

        <h2 id="best-practices">Best Practices</h2>
        <ol>
            <li><strong>One Store Per Feature</strong>: We use a single store for all product-related functionality</li>
            <li><strong>Selective Persistence</strong>: Only persist necessary data to localStorage</li>
            <li><strong>One-Time API Loading</strong>: Products are loaded only once from the API</li>
            <li><strong>Local CRUD Operations</strong>: After initial load, all operations happen locally</li>
            <li><strong>Reactive Getters</strong>: Use computed properties for derived state</li>
            <li><strong>Clear Action Names</strong>: Actions have descriptive names that indicate their purpose</li>
            <li><strong>Error Handling</strong>: Proper error handling for API calls</li>
            <li><strong>Loading States</strong>: Show loading indicators during API operations</li>
        </ol>

        <h2>Example Usage in Components</h2>

        <h3>HomeView.vue (Product Display)</h3>
        <pre><code>&lt;script setup&gt;
import { onMounted } from 'vue'
import { useProductStore } from '@/stores/product'

const productStore = useProductStore()

onMounted(() => {
  productStore.fetchProducts()
})
&lt;/script&gt;

&lt;template&gt;
  &lt;div v-if="productStore.loading"&gt;Loading...&lt;/div&gt;
  &lt;div v-else-if="productStore.error"&gt;Error: {{ productStore.error }}&lt;/div&gt;
  &lt;div v-else&gt;
    &lt;ProductList 
      :products="productStore.products" 
      @add-to-cart="productStore.addToCart"
    /&gt;
  &lt;/div&gt;
&lt;/template&gt;</code></pre>

        <h3>CartView.vue (Cart Management)</h3>
        <pre><code>&lt;script setup&gt;
import { useProductStore } from '@/stores/product'

const productStore = useProductStore()
&lt;/script&gt;

&lt;template&gt;
  &lt;div&gt;
    &lt;div v-for="item in productStore.cart" :key="item.id"&gt;
      &lt;span&gt;{{ item.title }}&lt;/span&gt;
      &lt;button @click="productStore.updateQuantity(item.id, item.quantity - 1)"&gt;
        -
      &lt;/button&gt;
      &lt;span&gt;{{ item.quantity }}&lt;/span&gt;
      &lt;button @click="productStore.updateQuantity(item.id, item.quantity + 1)"&gt;
        +
      &lt;/button&gt;
      &lt;button @click="productStore.removeFromCart(item.id)"&gt;
        Remove
      &lt;/button&gt;
    &lt;/div&gt;
    &lt;div&gt;Total: \${{ productStore.cartTotal.toFixed(2) }}&lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;</code></pre>

        <div class="tip">
            <p><strong>Tip:</strong> This implementation provides a complete state management solution with automatic persistence, making it perfect for e-commerce applications where data needs to persist between sessions.</p>
        </div>
    </div>
</body>
</html>